{% extends "base.html" %}

{% block title %}Spawning{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/spawning.css') }}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-magic me-2"></i>Sistema de Spawning</h2>
    </div>

    <!-- Seletor de Modo de Spawn -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="spawn-mode-selector">
                <label class="fw-bold me-3">Modo de Spawn:</label>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="spawnMode" id="modePlayer" value="player" checked>
                    <label class="form-check-label" for="modePlayer">
                        <i class="fas fa-user me-2"></i>Por Jogador
                    </label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="spawnMode" id="modeCoords" value="coords">
                    <label class="form-check-label" for="modeCoords">
                        <i class="fas fa-map-marked-alt me-2"></i>Por Coordenadas no Mapa
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Seletor Global de Jogador -->
    <div class="card mb-4" id="playerSelectCard">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-2">
                    <label class="form-label fw-bold">Jogador:</label>
                </div>
                <div class="col-md-6">
                    <select id="globalPlayerSelect" class="form-select">
                        <option value="">Carregando jogadores...</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <div id="selectedPlayerInfo" class="text-muted">
                        <small>Nenhum jogador selecionado</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Seletor de Coordenadas do Mapa -->
    <div class="card mb-4" id="coordsSelectCard" style="display: none;">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-2">
                    <label class="form-label fw-bold">Localização:</label>
                </div>
                <div class="col-md-8">
                    <button class="btn btn-primary btn-lg" id="openMapBtn">
                        <i class="fas fa-map me-2"></i>
                        <span id="openMapText">Abrir Mapa e Selecionar Coordenadas</span>
                        <span id="coordsDisplay" class="coords-display" style="display: none;"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#weapons-tab">
                <i class="fas fa-crosshairs me-2"></i>Armas
            </a>
        </li>        
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#explosives-tab">
                <i class="fas fa-bomb me-2"></i>Explosivos
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#ammo-tab">
                <i class="fas fa-bullseye me-2"></i>Munições
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#magazines-tab">
                <i class="fas fa-battery-full me-2"></i>Magazines
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#attachments-tab">
                <i class="fas fa-puzzle-piece me-2"></i>Attachments
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#items-tab">
                <i class="fas fa-box me-2"></i>Itens gerais
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#vehicles-tab">
                <i class="fas fa-car me-2"></i>Veículos
            </a>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Aba de Armas -->
        <div id="weapons-tab" class="tab-pane fade show active">
            <div class="row mb-3">
                <div class="col-md-3">
                    <button class="btn btn-success" onclick="loadCompleteWeaponLoadout()">
                        <i class="fas fa-layer-group me-2"></i>Loadout Completo
                    </button>
                </div>
                <div class="col-md-2">
                    <input type="text" id="weaponSearchInput" class="form-control" placeholder="Buscar arma...">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterFeedType">
                        <option value="">Todos Feed Types</option>
                        <option value="magazine">Magazine</option>
                        <option value="manual">Manual</option>
                        <option value="internal">Internal</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterWeaponSize">
                        <option value="">Todos Tamanhos</option>
                        <option value="small">Pequenas (≤12)</option>
                        <option value="large">Grandes (>12)</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterCaliber">
                        <option value="">Todos Calibres</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="weaponQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>
            
            <div id="weaponsGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Explosivos -->
        <div id="explosives-tab" class="tab-pane fade">
            <div class="row mb-3">
                <div class="col-md-11">
                    <input type="text" id="explosiveSearchInput" class="form-control" placeholder="Buscar explosivo...">
                </div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="explosiveQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>

            <div id="explosivesGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Munições -->
        <div id="ammo-tab" class="tab-pane fade">
            <div class="row mb-3">
                <div class="col-md-3">
                    <input type="text" id="ammoSearchInput" class="form-control" placeholder="Buscar munição...">
                </div>
                <div class="col-md-3">
                    <select id="ammoWeaponFilter" class="form-select">
                        <option value="">Todas as armas</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select id="caliberSelect" class="form-select">
                        <option value="">Todos calibres</option>
                    </select>
                </div>
                <div class="col-md-5"></div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="ammoQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>

            <div id="ammunitionsGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Magazines -->
        <div id="magazines-tab" class="tab-pane fade">
            <div class="row mb-3">
                <div class="col-md-4">
                    <input type="text" id="magazineSearchInput" class="form-control" placeholder="Buscar magazine...">
                </div>
                <div class="col-md-7">
                    <select id="magazineWeaponFilter" class="form-select">
                        <option value="">Todas as armas</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="magazineQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>

            <div id="magazinesGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Attachments -->
        <div id="attachments-tab" class="tab-pane fade">
            <div class="row mb-3">
                <div class="col-md-3">
                    <input type="text" id="attachmentSearchInput" class="form-control" placeholder="Buscar attachment...">
                </div>
                <div class="col-md-4">
                    <select id="attachmentWeaponFilter" class="form-select">
                        <option value="">Todas as armas</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select id="attachmentTypeSelect" class="form-select">
                        <option value="">Todos os tipos</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="attachmentQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>

            <div id="attachmentsGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Itens -->
        <div id="items-tab" class="tab-pane fade">
            <div class="row mb-3">
                <div class="col-md-2">
                    <input type="text" id="itemSearchInput" class="form-control" placeholder="Buscar item...">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterItemType">
                        <option value="">Todos Tipos</option>
                        <!-- Populated by JS -->
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterItemLocation">
                        <option value="">Todas Localizações</option>
                        <option value="none">Nenhuma</option>
                        <option value="back">Back</option>
                        <option value="eyes">Eyes</option>
                        <option value="face">Face</option>
                        <option value="foot">Foot</option>
                        <option value="hands">Hands</option>
                        <option value="head">Head</option>
                        <option value="legs">Legs</option>
                        <option value="torso">Torso</option>
                        <option value="waist">Waist</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterItemStorage">
                        <option value="">Todos</option>
                        <option value="with">Com Storage</option>
                        <option value="without">Sem Storage</option>
                    </select>
                </div>
                <div class="col-md-3"></div>
                <div class="col-md-1">
                    <label>Qtd</label>
                    <input type="number" id="itemQuantity" class="form-control" value="1" min="1" max="99">
                </div>
            </div>
            
            <div id="itemsGrid" class="weapons-grid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Aba de Veículos -->
        <div id="vehicles-tab" class="tab-pane fade">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Selecione um jogador na parte superior da página para spawnar veículos próximo a ele.
            </div>

            <div id="vehiclesGrid" class="vehicles-grid">
                <!-- Grid de veículos será gerado aqui -->
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div class="modal fade" id="spawnConfirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmar Spawn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Item:</strong> <span id="confirmItemName"></span></p>
                <p id="confirmPlayerSection"><strong>Jogador:</strong> <span id="confirmPlayerName"></span></p>
                <p id="confirmCoordsSection" style="display: none;"><strong>Coordenadas:</strong> <span id="confirmCoords"></span></p>
                <p><strong>Quantidade:</strong> <span id="confirmQuantity"></span></p>
                <div id="confirmCoordsDetail" class="spawn-confirm-coords" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="confirmSpawnBtn">
                    <i class="fas fa-magic me-1"></i>Spawnar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal do Mapa para Seleção de Coordenadas -->
<div class="modal fade" id="spawnMapModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-map me-2"></i>Selecione as Coordenadas no Mapa
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="map-instructions">
                    <i class="fas fa-crosshairs me-2"></i>Clique no mapa para selecionar a localização
                </div>
                <div id="spawnMap" data-map-image="{{ url_for('static', filename='img/chernarus.jpeg') }}"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Loadout Completo -->
<div class="modal fade" id="loadoutModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-layer-group me-2"></i>Loadout Completo - <span id="loadoutWeaponName"></span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Magazines -->
                <h6><i class="fas fa-battery-full me-2"></i>Magazines Compatíveis</h6>
                <div id="loadoutMagazinesGrid" class="loadout-grid mb-4"></div>
                
                <!-- Munições -->
                <h6><i class="fas fa-bullseye me-2"></i>Munições Compatíveis</h6>
                <div id="loadoutAmmunitionsGrid" class="loadout-grid mb-4"></div>
                
                <!-- Attachments -->
                <h6><i class="fas fa-puzzle-piece me-2"></i>Attachments Compatíveis</h6>
                <div id="loadoutAttachmentsGrid" class="loadout-grid"></div>
            </div>
            <div class="modal-footer">
                <div class="me-auto">
                    <strong>Itens selecionados:</strong> <span id="loadoutSelectedCount">0</span>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="spawnLoadoutBtn">
                    <i class="fas fa-magic me-1"></i>Spawnar Tudo
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/spawning.js') }}"></script>
{% endblock %}
